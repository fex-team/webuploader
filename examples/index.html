<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>WebUploader演示</title>
    <link rel="stylesheet" type="text/css" href="../css/webuploader.css" />
    <link rel="stylesheet" type="text/css" href="./style.css" />
</head>
<body>
    <div id="dndArea" class="stage">
        <div class="queueList">
            <ul id="queueList"></ul>
        </div>

        <div class="btns">
            <div id="pickerBtn">
            </div><div id="uploadBtn">开始上传</div>
        </div>
    </div>
    <script type="text/javascript" src="./jquery.js"></script>
    <script type="text/javascript" src="../dist/webuploader.js"></script>

    <script type="text/javascript">
        var wu = WebUploader.create({
                pick: 'pickerBtn',
                dnd: 'dndArea',
                paste: 'dndArea',
                server: 'http://liaoxuezhi.fe.baidu.com/webupload/fileupload.php'
            }),
            btn = $( '#uploadBtn' );

        wu.onFileQueued = function ( file ) {
            var li = $( '<li id="' + file.id + '">' ),
                btn = $( '<a href="javascript:void(0)" class="delete">删除</a>'),
                ratio = window.devicePixelRatio || 1,
                width = 120 * ratio,
                height = 90 * ratio;

            wu.getImageThumbnail( file, function( img ) {
                li.prepend( img );
                $( img ).css( 'width', (width / ratio) + 'px' );
            }, width, height );

            li.append( '<p>' + file.name + '</p>');
            li.append( btn );

            btn.on( 'click', function() {
                wu.removeFile( file );
            });

            li.appendTo( '#queueList' );

            file.on( 'statuschange', function( cur, pre ) {

                li.removeClass('progress failed interrupt');

                switch ( cur ) {
                    case 3:    // error
                        li.find( 'p.progress' ).fadeOut();
                        li.addClass( 'failed' );
                        break;

                    case 6:
                        li.addClass( 'interrupt' );
                        break;

                    case 4:
                        li.addClass( 'finished' );
                        break;

                    case 5:
                        li.fadeOut();
                        break;
                }
            });
        };

        wu.onUploadStart = function( file ) {
            var li = $( '#' + file.id );
            li.append( '<p class="progress"><span></span></p>' );
            li.addClass( 'progress' );
        }

        wu.onUploadProgress = function( file, percent ) {
            var li = $( '#' + file.id ),
                progress = li.find( 'p.progress span' );

            progress.css({
                width: percent * 100 + '%'
            })
        }

        wu.onUploadComplete = function( file ) {
            var li = $( '#' + file.id ),
                progress = li.find( 'p.progress' );

            progress.fadeOut();
        };

        wu.onUploadFinished = function() {
            btn.text( '开始上传' );
        }

        wu.onOnline = function() {
            wu.upload();
            alert( '网络恢复，继续上传' )
        };

        wu.onOffline = function() {
            wu.stop();
            alert( '网络中断，暂停上传' )
        }

        btn.on( 'click', function() {
            var text = $(btn).text();

            if ( text === '开始上传' || text === '继续上传' ) {
                wu.upload();
                btn.text( '暂停上传' );
            } else if ( text === '暂停上传' ) {
                wu.stop();
                btn.text( '继续上传' );
            }
        } );

        $( '#queueList' ).on( 'click', 'a.delete', function() {
            var li = $(this).closest( 'li' );

            wu.removeFile( li.attr( 'id' ) );
        });
    </script>
</body>
</html>